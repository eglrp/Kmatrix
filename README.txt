This code might be working, however, bugs are very possible, so needs some debugging (especially on the level of jacobian-error when doing LMA). The calculation of K matrix is based on synthetically generated data (no real image, only coordiantes). 

The basic functions are implemented, so it must not be difficult to adapt it for using with real images if necessary.